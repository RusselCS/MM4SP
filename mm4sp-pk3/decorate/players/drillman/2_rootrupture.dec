actor Drill_WoodWep : BaseMM8BDMWep
{
Dropitem ""
inventory.icon "DRII2"
Weapon.AmmoUse 1
Weapon.AmmoGive 112
Weapon.SlotNumber 2
Tag "Root Rupture"
Inventory.Pickupmessage "Power up! Root Rupture!"
weapon.ammotype "RootRuptureAmmo"
+INVENTORY.UNDROPPABLE
States
{
Spawn:
DRI2 I 1
loop
Ready:
DRI2 A 0 ACS_ExecuteAlways(998,0,2)
DRI2 A 1 A_WeaponReady
Goto Ready+1
Deselect:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Lower
DRI2 A 1 A_Lower
Loop
Select:
TNT1 AAAAAAAAAAAAAAAAAAAAAA 0 A_Raise
DRI2 A 1 A_Raise
Loop
Fire:
DRI2 A 0 A_JumpIfNoAmmo("NoAmmo")
DRI2 A 0 A_JumpIf(z-floorz!=0,2)
DRI2 A 0 ThrustThingZ(0,50,0,0)
DRI2 A 0 A_GiveInventory("RootRuptureUsed",1)
DRI2 A 0 A_GiveInventory("RootRuptureProtect",1)
DRI2 BC 3
goto AirLoop
AirLoop:
DRI2 C 0 A_SpawnItemEx("RootRuptureDamager",0,0,-1)
DRI2 C 1 A_JumpIf(z-floorz==0,"DigStart")
loop
DigStart:
DRIA A 0 A_SetTranslucent(0.0,0)
DRIA A 0 A_TakeInventory("RootRuptureUsed",999)
DRIA A 0 A_ChangeFlag("INVULNERABLE",1)
DRIA A 0 A_GiveInventory("IsInvuln",1)
DRIA A 0 A_ChangeFlag("NONSHOOTABLE",1)
DRIA A 0 A_ChangeFlag("NOTARGET",1)
DRIA A 0 A_ChangeFlag("SOLID",0)
DRIA A 0 A_ChangeFlag("PICKUP",0)
TNT1 A 0 A_SpawnItemEX("RootRuptureFXSpawner")
TNT1 A 0 A_GiveInventory("RootRupturePowerup",1)
TNT1 A 0 ACS_ExecuteAlways(191,0,APROP_JumpZ,0,1)
goto DigLoop
DigLoop:
TNT1 A 0 A_TakeInventory("RootRuptureAmmo",1)
TNT1 A 0 A_PlayWeaponSound("classes/drilling")
TNT1 A 0 A_SpawnItemEX("RootRupture")
TNT1 AA 0 A_SpawnItemEx("RootRuptureFX",0,0,8,random(-10,10),0,random(2,12),random(0,359),1)
TNT1 A 2 A_SpawnItemEX("DrillWallChecker",0,0,0)
TNT1 A 0 A_JumpIfNoAmmo("DigEnd")
TNT1 A 0 A_Refire("DigLoop2")
goto DigEnd
DigLoop2:
TNT1 A 0 A_TakeInventory("RootRuptureAmmo",1)
TNT1 A 0 A_PlayWeaponSound("classes/drilling")
TNT1 AA 0 A_SpawnItemEx("RootRuptureFX",0,0,8,random(-10,10),0,random(2,12),random(0,359),1)
TNT1 A 2 A_SpawnItemEX("DrillWallChecker",0,0,0)
TNT1 A 0 A_JumpIfNoAmmo("DigEnd")
TNT1 A 0 A_Refire("DigLoop3")
goto DigEnd
DigLoop3:
TNT1 A 0 A_TakeInventory("RootRuptureAmmo",1)
TNT1 A 0 A_PlayWeaponSound("classes/drilling")
TNT1 AA 0 A_SpawnItemEx("RootRuptureFX",0,0,8,random(-10,10),0,random(2,12),random(0,359),1)
TNT1 A 2 A_SpawnItemEX("DrillWallChecker",0,0,0)
TNT1 A 0 A_JumpIfNoAmmo("DigEnd")
TNT1 A 0 A_Refire("DigLoop4")
goto DigEnd
DigLoop4:
TNT1 A 0 A_TakeInventory("RootRuptureAmmo",1)
TNT1 A 0 A_PlayWeaponSound("classes/drilling")
TNT1 AA 0 A_SpawnItemEx("RootRuptureFX",0,0,8,random(-10,10),0,random(2,12),random(0,359),1)
TNT1 A 2 A_SpawnItemEX("DrillWallChecker",0,0,0)
TNT1 A 0 A_JumpIfNoAmmo("DigEnd")
TNT1 A 0 A_Refire("DigLoop")
goto DigEnd
DigEnd:
DRI2 B 0 A_ClearRefire
DRI2 B 0 ThrustThingZ(0,70,0,0)
DRI2 A 0 A_SetTranslucent(1.0,0)
DRI2 A 0 A_ChangeFlag("PICKUP",1)
DRI2 A 0 A_PlayWeaponSound("classes/drillout")
DRI2 A 0 A_SpawnItemEX("RootRuptureFXSpawner")
DRI2 AAAAAAAAAAAAAAAAAA 0 A_SpawnItemEx("RootRuptureFX",0,0,8,random(-20,20),0,random(10,30),random(0,359),1)
DRI2 A 0 A_TakeInventory("RootRupturePowerup",999)
DRI2 A 0 A_ChangeFlag("THRUACTORS",1)
DRI2 A 0 ACS_ExecuteAlways(191,0,APROP_JumpZ,10,1)
DRI2 C 0 A_SpawnItemEx("RootRuptureDamager",0,0,-1)
DRI2 C 1 A_ChangeFlag("FLOORHUGGER",0)
DRI2 C 0 A_SpawnItemEx("RootRuptureDamager",0,0,-1)
DRI2 C 1 A_ChangeFlag("FLOORHUGGER",0)
DRI2 C 0 A_SpawnItemEx("RootRuptureDamager",0,0,-1)
DRI2 C 1 A_ChangeFlag("FLOORHUGGER",0)
DRI2 C 0 A_SpawnItemEx("RootRuptureDamager",0,0,-1)
DRI2 C 1 A_ChangeFlag("FLOORHUGGER",0)
DRI2 C 0 A_SpawnItemEx("RootRuptureDamager",0,0,-1)
DRI2 C 1 A_ChangeFlag("FLOORHUGGER",0)
DRI2 C 0 A_SpawnItemEx("RootRuptureDamager",0,0,-1)
DRI2 C 1 A_ChangeFlag("FLOORHUGGER",0)
DRI2 C 0 A_TakeInventory("RootRuptureProtect",999)
DRI2 A 0 A_ChangeFlag("NONSHOOTABLE",0)
DRI2 A 0 A_ChangeFlag("INVULNERABLE",0)
DRI2 A 0 A_TakeInventory("IsInvuln",999)
DRI2 A 0 A_ChangeFlag("NOTARGET",0)
DRI2 C 0 A_ChangeFlag("THRUACTORS",0)
DRI2 A 0 A_SpawnItemEX("Resolidifier")//A_ChangeFlag("SOLID",1)
DRI2 CB 3
DRI2 A 6
goto Ready+1
NoAmmo:
DRI2 A 1 ACS_Execute(979,0)
Goto Ready+1
}
}

actor RootRuptureUsed : Once {}

actor RootRuptureAmmo : Ammo
{
inventory.amount 1
inventory.maxamount 112
+INVENTORY.IGNORESKILL
}

actor RootRuptureDamager
{
PROJECTILE
+DONTBLAST
+DONTREFLECT
damage (4)
Radius 16
Height 58
damagetype "LeafShield"
renderstyle none
States
{
Spawn:
TNT1 A 1
stop
}
}

actor RootRuptureFXSpawner
{
+MISSILE
-SOLID
+NOCLIP
+NOINTERACTION
+NOGRAVITY
+DONTBLAST
+DONTREFLECT
+THRUACTORS
renderstyle none
radius 2
height 2
ReactionTime 4
States
{
Spawn:
TNT1 A 0
TNT1 A 0 A_Jump(256,1,3,5)
TNT1 A 0 A_SpawnItemEx("RootRuptureDigFX",random(0,36),0,random(0,16),0,0,0,random(0,359),1)
TNT1 A 3 A_CountDown
TNT1 A 0 A_SpawnItemEx("RootRuptureDigFX",random(0,30),0,random(20,36),0,0,0,random(0,359),1)
TNT1 A 3 A_CountDown
TNT1 A 0 A_SpawnItemEx("RootRuptureDigFX",random(0,24),0,random(40,56),0,0,0,random(0,359),1)
TNT1 A 3 A_CountDown
goto Spawn+2
}
}

actor RootRuptureDigFX : BasicClientSide
{
Scale 3.0
States
{
Spawn:
DRI2 DEFGH 5
stop
}
}

actor RootRuptureFX
{
+DONTBLAST
+MISSILE
-NOGRAVITY
+RIPPER
+THRUACTORS
+CLIENTSIDEONLY
+FLOORCLIP
Damage (0)
Height 5
Radius 5
Speed 30
Scale 2.5
States
{
Spawn:
DRI2 Q 0
DRI2 Q 30
stop
}
}

actor RootRupturePowerup : PowerSpeed
{
+POWERSPEED.NOTRAIL
Speed 1.2
}

actor RootRuptureProtect : PowerProtection
{
Powerup.Duration 0x7FFFFFFF
damagefactor "EnemyContact", 0.0
}

actor DrillWallChecker
{
PROJECTILE
+DONTREFLECT
+DONTBLAST
+NOTARGETSWITCH
+FLOORHUGGER
renderstyle none
speed 0
damage (0)
radius 60
height 2
+THRUACTORS
var int user_height;
states
{
Spawn:
PLAY A 0
PLAY A 0 A_SetUserVar("user_height",CallACS("4SP_GetHeight"))
PLAY A 0 A_JumpIf(z-user_height>64,"NoFloorHuggerForYou")
PLAY A 1 A_Jump(256,"YesFloorHuggerForYou")
wait
YesFloorHuggerForYou:
PLAY A 1 A_GiveToTarget("DrillWarpYes")
stop
NoFloorHuggerForYou:
PLAY H 1 A_GiveToTarget("DrillWarpNo")
stop
}
}

actor DrillWarpNo : CustomInventory
{
inventory.amount 1
inventory.maxamount 1
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 1
loop
Use:
TNT1 A 0 A_ChangeFlag("FLOORHUGGER",0)
stop
}
}

actor DrillWarpYes : CustomInventory
{
inventory.amount 1
inventory.maxamount 1
+AUTOACTIVATE
States
{
Spawn:
TNT1 A 1
loop
Use:
TNT1 A 0 A_ChangeFlag("FLOORHUGGER",1)
stop
}
}

actor RootRupture
{
damagetype "LeafShield"
+MTHRUSPECIES
-EXPLODEONWATER
+DONTSPLASH
+NOGRAVITY
-SOLID
+MISSILE
Radius 1
Height 1
scale 2.5
speed 0
States
{
Spawn:
TNT1 A 0
TNT1 A 0 A_PlaySound("classes/rootrupture",1,0.5)
DRI2 JKLMNOPPPONMLKJ 2 A_Explode(4, 50, 0, 50)
stop
}
}